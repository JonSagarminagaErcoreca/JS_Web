<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acceso</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles/global.css">
  <script defer src="./scripts/i18n.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100dvh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      font-family: 'Montserrat Alternates', system-ui, sans-serif;
    }

    .password-container {
      width: min(400px, 90vw);
      max-width: 400px;
      padding: 48px 32px;
      background: var(--card);
      border-radius: 20px;
      box-shadow: 0 18px 44px rgba(0,0,0,.12);
      border: 1px solid var(--stroke);
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .password-container h1 {
      margin: 0 0 8px 0;
      font-size: 24px;
      font-weight: 700;
      color: var(--text);
      letter-spacing: -0.01em;
    }

    .password-container p {
      margin: 0 0 32px 0;
      font-size: 14px;
      color: var(--muted);
      line-height: 1.6;
    }

    .password-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .password-input-wrapper {
      position: relative;
    }

    .password-input {
      width: 100%;
      padding: 14px 48px 14px 16px;
      border: 1px solid var(--stroke);
      border-radius: 12px;
      background: var(--fill-soft);
      color: var(--text);
      font-family: 'Montserrat Alternates', system-ui, sans-serif;
      font-size: 16px;
      font-weight: 400;
      transition: border-color .18s ease, background .18s ease, box-shadow .18s ease;
      box-sizing: border-box;
    }

    .password-input:focus {
      outline: none;
      border-color: var(--input-focus-color, var(--text));
      background: var(--card);
      box-shadow: 0 0 0 3px rgba(15,23,42,.05);
    }

    .password-input::placeholder {
      color: var(--muted);
    }

    .password-error {
      display: none;
      margin: -8px 0 0 0;
      font-size: 13px;
      color: #dc2626;
      padding: 8px 12px;
      background: rgba(220, 38, 38, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(220, 38, 38, 0.2);
    }

    .password-error.show {
      display: block;
    }

    .password-submit {
      padding: 14px 24px;
      border: 1px solid var(--stroke);
      border-radius: 12px;
      background: var(--text);
      color: var(--bg);
      font-family: 'Montserrat Alternates', system-ui, sans-serif;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform .18s ease, background .18s ease, box-shadow .18s ease;
      width: 100%;
    }

    .password-submit:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }

    .password-submit:active {
      transform: translateY(0);
    }

    .password-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .password-toggle-eye {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      transition: color .18s ease;
      z-index: 2;
    }

    .password-toggle-eye:hover {
      color: var(--text);
    }

    .password-toggle-eye svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      stroke-width: 1.5;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .password-toggle-eye.hidden {
      display: none;
    }

    .colorize-button {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10001;
      
      padding: 13px 60px;
      border: none;
      border-radius: 12px;
      
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      
      color: var(--outline-color, #000000);
      font-family: 'Montserrat Alternates', system-ui, sans-serif;
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.02em;
      
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .colorize-button:hover {
      transform: translateX(-50%) translateY(-2px);
      background: rgba(255, 255, 255, 0.25);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      scale: 1.05;
    }
    
    .colorize-button:active {
      transform: translateX(-50%) translateY(0px);
      scale: 0.98;
    }
  </style>
</head>
<body>
  <!-- BG de Unicorn -->
  <div id="us-bg" data-us-project="IsMdT1kRU5X0UR1VrDzM" data-us-fps="60" data-us-scale="1.0" data-us-logo="false"></div>

  <!-- Botón Colorize fijo -->
  <button id="colorizeBtn" class="colorize-button">
    Colorize
  </button>

  <div class="password-container">
    <h1 data-i18n="password.title">Acceso Requerido</h1>
    <p data-i18n="password.desc">Por favor, introduce la contraseña para continuar.</p>
    <form class="password-form" id="passwordForm">
      <div class="password-input-wrapper">
        <input 
          type="password" 
          class="password-input" 
          id="passwordInput" 
          placeholder="Introduce la contraseña"
          data-i18n-placeholder="password.placeholder"
          autocomplete="off"
          autofocus
          required
        />
        <button 
          type="button" 
          class="password-toggle-eye" 
          id="passwordToggleEye"
          aria-label="Mostrar contraseña"
        >
          <!-- Icono ojo visible -->
          <svg id="eyeIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
          <!-- Icono ojo tachado (oculto por defecto) -->
          <svg id="eyeOffIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="display: none;">
            <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
            <line x1="1" y1="1" x2="23" y2="23"/>
          </svg>
        </button>
        <div class="password-error" id="passwordError" data-i18n="password.error">
          Contraseña incorrecta. Por favor, inténtalo de nuevo.
        </div>
      </div>
      <button type="submit" class="password-submit" id="passwordSubmit" data-i18n="password.submit">
        Continuar
      </button>
    </form>
  </div>

  <script>
    const CORRECT_PASSWORD = 'Portfolio';
    const AUTH_KEY = 'portfolio_authenticated';
    const AUTH_TIMESTAMP = 'portfolio_auth_timestamp';
    const SESSION_DURATION = 24 * 60 * 60 * 1000; // 24 horas

    // Verificar si ya está autenticado
    function isAuthenticated() {
      const auth = sessionStorage.getItem(AUTH_KEY);
      const timestamp = sessionStorage.getItem(AUTH_TIMESTAMP);
      
      if (!auth || !timestamp) return false;
      
      const now = Date.now();
      const authTime = parseInt(timestamp, 10);
      
      // Si pasaron más de 24 horas, requerir autenticación de nuevo
      if (now - authTime > SESSION_DURATION) {
        sessionStorage.removeItem(AUTH_KEY);
        sessionStorage.removeItem(AUTH_TIMESTAMP);
        return false;
      }
      
      return auth === 'true';
    }

    // Si ya está autenticado, redirigir a work
    if (isAuthenticated()) {
      window.location.href = './work.html';
    }

    const form = document.getElementById('passwordForm');
    const input = document.getElementById('passwordInput');
    const error = document.getElementById('passwordError');
    const submit = document.getElementById('passwordSubmit');
    const toggleEye = document.getElementById('passwordToggleEye');
    const eyeIcon = document.getElementById('eyeIcon');
    const eyeOffIcon = document.getElementById('eyeOffIcon');

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const password = input.value.trim();
      
      if (password === CORRECT_PASSWORD) {
        // Guardar autenticación
        sessionStorage.setItem(AUTH_KEY, 'true');
        sessionStorage.setItem(AUTH_TIMESTAMP, Date.now().toString());
        
        // Redirigir a work
        window.location.href = './work.html';
      } else {
        // Mostrar error
        error.classList.add('show');
        input.value = '';
        input.focus();
        
        // Ocultar error después de 3 segundos
        setTimeout(() => {
          error.classList.remove('show');
        }, 3000);
      }
    });

    // Permitir Enter para enviar
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        form.dispatchEvent(new Event('submit'));
      }
    });

    // Toggle mostrar/ocultar contraseña
    toggleEye.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      
      if (input.type === 'password') {
        input.type = 'text';
        eyeIcon.style.display = 'none';
        eyeOffIcon.style.display = 'block';
        toggleEye.setAttribute('aria-label', 'Ocultar contraseña');
      } else {
        input.type = 'password';
        eyeIcon.style.display = 'block';
        eyeOffIcon.style.display = 'none';
        toggleEye.setAttribute('aria-label', 'Mostrar contraseña');
      }
    });

    // Sistema de colores para el input (similar a index.html)
    let lastInputColor = '#0f172a';
    let lastBorderColor = 'rgba(15,23,42,.10)';
    const passwordContainer = document.querySelector('.password-container');

    function randomColor(opacity) {
      const r = Math.floor(Math.random() * 256);
      const g = Math.floor(Math.random() * 256);
      const b = Math.floor(Math.random() * 256);
      return {
        full: `rgba(${r}, ${g}, ${b}, ${opacity})`,
        solid: `rgb(${r}, ${g}, ${b})`,
        r: r,
        g: g,
        b: b
      };
    }

    // Función para desaturar y añadir transparencia a un color
    function desaturateColor(color, saturation = 0.3, opacity = 0.15) {
      // Convertir RGB a HSL para desaturar
      const r = color.r / 255;
      const g = color.g / 255;
      const b = color.b / 255;
      
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;
      
      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }
      
      // Aplicar desaturación
      s = s * saturation;
      
      // Convertir de vuelta a RGB
      const c = (1 - Math.abs(2 * l - 1)) * s;
      const x = c * (1 - Math.abs((h * 6) % 2 - 1));
      const m = l - c / 2;
      
      let r2, g2, b2;
      if (h < 1/6) { r2 = c; g2 = x; b2 = 0; }
      else if (h < 2/6) { r2 = x; g2 = c; b2 = 0; }
      else if (h < 3/6) { r2 = 0; g2 = c; b2 = x; }
      else if (h < 4/6) { r2 = 0; g2 = x; b2 = c; }
      else if (h < 5/6) { r2 = x; g2 = 0; b2 = c; }
      else { r2 = c; g2 = 0; b2 = x; }
      
      r2 = Math.round((r2 + m) * 255);
      g2 = Math.round((g2 + m) * 255);
      b2 = Math.round((b2 + m) * 255);
      
      return `rgba(${r2}, ${g2}, ${b2}, ${opacity})`;
    }

    function setInputColors() {
      const borderColor = randomColor(1);
      const textColor = randomColor(1);
      const focusColor = randomColor(0.8);
      
      // Generar color de fondo desaturado basado en el color del borde
      const bgColor = desaturateColor(borderColor, 0.3, 0.15);

      lastInputColor = textColor.solid;
      lastBorderColor = borderColor.solid;

      // Aplicar colores al input
      input.style.borderColor = borderColor.solid;
      input.style.color = textColor.solid;
      
      // Aplicar color al icono del ojo (mismo color que el borde)
      if (toggleEye) {
        toggleEye.style.color = borderColor.solid;
      }
      
      // Aplicar color de fondo al contenedor
      if (passwordContainer) {
        passwordContainer.style.backgroundColor = bgColor;
      }
      
      // Guardar en localStorage
      const colorScheme = {
        inputBorderColor: borderColor.solid,
        inputTextColor: textColor.solid,
        inputFocusColor: focusColor.solid,
        containerBgColor: bgColor
      };
      localStorage.setItem('passwordInputColorScheme', JSON.stringify(colorScheme));

      // Actualizar CSS custom properties para el focus
      document.documentElement.style.setProperty('--input-focus-color', focusColor.solid);
    }

    function loadSavedInputColors() {
      const saved = localStorage.getItem('passwordInputColorScheme');
      if (saved) {
        try {
          const colorScheme = JSON.parse(saved);
          input.style.borderColor = colorScheme.inputBorderColor;
          input.style.color = colorScheme.inputTextColor;
          document.documentElement.style.setProperty('--input-focus-color', colorScheme.inputFocusColor);
          if (passwordContainer && colorScheme.containerBgColor) {
            passwordContainer.style.backgroundColor = colorScheme.containerBgColor;
          }
          // Cargar color del icono del ojo
          if (toggleEye && colorScheme.inputBorderColor) {
            toggleEye.style.color = colorScheme.inputBorderColor;
          }
          lastInputColor = colorScheme.inputTextColor;
          lastBorderColor = colorScheme.inputBorderColor;
        } catch (e) {
          console.warn('Error loading saved input color scheme:', e);
        }
      }
    }

    // Conectar botón Colorize
    document.getElementById('colorizeBtn').addEventListener('click', () => {
      setInputColors();
    });

    // Cargar colores guardados al inicializar
    loadSavedInputColors();

    // Cambiar colores al hacer focus en el input
    input.addEventListener('focus', () => {
      if (!input.style.borderColor || input.style.borderColor === 'rgba(15, 23, 42, 0.1)') {
        setInputColors();
      }
    });
  </script>
  <script type="text/javascript">
    !function(){
      if(!window.UnicornStudio){
        window.UnicornStudio={isInitialized:!1};
        var i=document.createElement("script");
        i.src="https://cdn.jsdelivr.net/gh/hiunicornstudio/unicornstudio.js@v1.4.31/dist/unicornStudio.umd.js";
        i.onload=function(){
          if(!window.UnicornStudio.isInitialized){
            UnicornStudio.init();
            window.UnicornStudio.isInitialized=!0;
          }
        };
        (document.head||document.body).appendChild(i);
      }
    }();
  </script>
</body>
</html>

